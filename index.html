<!DOCTYPE html>
<html ng-app="ionicApp">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width" />
  <title>FogCloud</title>
  <link href="//api.easylink.io/bower_components/ionic/css/ionic.min.css" rel="stylesheet">
  <script src="//api.easylink.io/bower_components/ionic/js/ionic.bundle.min.js"></script>
  <script type="text/javascript">


    angular.module('ionicApp', ['ionic'])
    .controller('MyCtrl', function($scope, $ionicPopup, $ionicListDelegate, $http) {
      $scope.items = device_list;
      $scope.access_token = access_token;
      
      $scope.data = {
        showDelete: false
      };
      $scope.listCanSwipe = true;
      $scope.showPopup = function(item) {
        var index = $scope.items.indexOf(item);
        $scope.data = {}

          // An elaborate, custom popup
          var myPopup = $ionicPopup.show({
            template: '<input type="text" ng-model="data.alias">',
            title: '',
            subTitle: '修改名称',
            scope: $scope,
            buttons: [
            { text: 'Cancel' },
            {
              text: '<b>Save</b>',
              type: 'button-positive',
              onTap: function(e) {
                if (!$scope.data.alias) {
                  e.preventDefault();
                } else {
                  $http.post(
                    'http://api.easylink.io/v1/device/modify',
                    {
                      device_id : item.device_id,
                      alias     : $scope.data.alias
                    }, {
                      headers : {
                        'AUTHORIZATION' : "token " + access_token
                      }
                    } 
                    ).success(function(data) {
                      $scope.items[index].alias = $scope.data.alias;
                      $ionicListDelegate.closeOptionButtons();

                    }).error(function(data){
                      alert(data.error.message);
                      return; 
                    });  
                  }
                }
              }
              ]
            });
};

});
</script>
</head>
<body ng-controller="MyCtrl">
  <ion-header-bar class="bar-positive">
  <h1 class="title">我的设备</h1>
</ion-header-bar>
</body>
</html>
